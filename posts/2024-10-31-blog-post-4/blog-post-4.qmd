---
title: "blog post 4"
author: ""
date: "2024-10-31"
date-modified: "2024-10-31"
draft: FALSE
---
```{r}
data <- readRDS("filtered_data_2.rds")

# Save it as a CSV file
write.csv(data, "your_file.csv", row.names = FALSE)
```
Used this to view data in excel file for easier visibility and filtering. 

```{r}
library(ggplot2)
library(here)
data <- readRDS(here("filtered_data_2.rds"))

filtered_data <- subset(data, Descent_Description != "Unknown" & Descent_Description != "Other")

# Create a contingency table for the filtered data
crime_table_filtered <- table(filtered_data$Descent_Description, filtered_data$Crm.Cd.Desc)

chi_test_filtered <- chisq.test(crime_table_filtered)
print(chi_test_filtered)
# Extract standardized residuals
standardized_residuals_filtered <- chi_test_filtered$stdres

top_crimes <- names(sort(colSums(crime_table_filtered), decreasing = TRUE))[1:20]

# Filter the contingency table to only include top crime types
crime_table_top <- crime_table_filtered[, top_crimes]

chi_test_top <- chisq.test(crime_table_top)
standardized_residuals_top <- chi_test_top$stdres


residuals_top_df <- as.data.frame(as.table(standardized_residuals_top))
colnames(residuals_top_df) <- c("Descent", "Crime_Type", "Residual")



ggplot(residuals_top_df, aes(x = Crime_Type, y = Descent, fill = Residual)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0) +
  labs(title = "Standardized Residuals of Descent and Top Crime Types",
       x = "Crime Type", y = "Descent Category", fill = "Residual") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

I wanted to ask the question of whether every crime was correlated to descent. Therefore, I conducted a chi-squared test and wanted to see how each race's residual was in comparison to the top 10 crimes (all crimes would be too much). 
- We can see that "White" had a high residual in the burglary category and higher residuals in some other categories as well. We also see lower than average residuals in the aggrevated assault and simple assault categories. 
- As for Hispanic/Mexican, even though they represent such a high amount of crimes (as seen in last blog post), they are moderately around what is expected with the exception of the "Burglary" and "Theft (under $950) categories.
- Other Asian slightly higher in "Burglary"
- "Black" lower in "theft from motor vehicle". 
- "Filipino" higher in "theft from motor vehicle". 
- "Chinese" higher in "theft - grand except guns or livestock". 
- Everything else is mostly the same hovering around the expected with small fluctuations.


```{r}
library(dplyr)
crime_hour_descent <- data %>%
  group_by(Hour, Crm.Cd.Desc, Descent_Description) %>%
  summarise(Count = n(), .groups = "drop") %>%
  filter(Count > 0)

ggplot(crime_hour_descent, aes(x = Hour, y = Descent_Description, fill = Count)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "lightblue", high = "darkred", name = "Crime Count") + 
  labs(title = "Heatmap of Crime Counts by Hour and Descent",
       x = "Hour of Day",
       y = "Descent Category")
```

I make this plot to visualize how crime frequency varies for each descent category by time of the day. I use heatmap since it provides a direct comparison across different times and descents. This plot clearly shows that certain racial categories, such as White, Hispanic/Latin/Mexican, and Black, experience higher crime rates compared to racial groups like Cambodian and Laotian, potentially due to smaller sample sizes or data collection biases.

The general trend across most categories indicates a peak in crime rates from late evening to early morning (00:00 to 05:00), which is the same as what we expected. However, an additional peak occurs during daytime (10:00 to 15:00), which is unusual and needs further investigation.
