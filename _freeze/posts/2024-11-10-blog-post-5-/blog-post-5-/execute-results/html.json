{
  "hash": "ff46b7984df07d0c3b676d4239ab1322",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"blog post 5 \"\nauthor: \"Sean Fung, Zihao Guo\"\ndate: \"2024-11-10\"\ndate-modified: \"2024-11-10\"\ndraft: FALSE\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLinking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(tidycensus)\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nhere() starts at /Users/zzzhao/Desktop/MA415/ma-4615-fa24-final-project-group-4\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(viridis)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: viridisLite\n```\n\n\n:::\n\n```{.r .cell-code}\n# Load the crime data and convert to spatial format\ndata <- readRDS(here(\"filtered_data_2.rds\"))\ncrime_sf <- st_as_sf(data, coords = c(\"LON\", \"LAT\"), crs = 4326)\n\n# Load neighborhood boundaries\nneighborhoods <- st_read(here(\"LA_Times_Neighborhood_Boundaries-shp/8494cd42-db48-4af1-a215-a2c8f61e96a22020328-1-621do0.x5yiu.shp\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `8494cd42-db48-4af1-a215-a2c8f61e96a22020328-1-621do0.x5yiu' from data source `/Users/zzzhao/Desktop/MA415/ma-4615-fa24-final-project-group-4/LA_Times_Neighborhood_Boundaries-shp/8494cd42-db48-4af1-a215-a2c8f61e96a22020328-1-621do0.x5yiu.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 114 features and 2 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 6359592 ymin: 1715035 xmax: 6514633 ymax: 1945515\nProjected CRS: NAD83 / California zone 5 (ftUS)\n```\n\n\n:::\n\n```{.r .cell-code}\nneighborhoods <- st_transform(neighborhoods, st_crs(crime_sf))\n\n# Perform the spatial join to link crime incidents with neighborhoods\ncrime_with_neighborhoods <- st_join(crime_sf, neighborhoods, join = st_within)\n\n# Load and join median income data\neconomic_data <- get_acs(\n    geography = \"block group\",\n    variables = c(median_income = \"B19013_001\"),\n    state = \"CA\",\n    county = \"Los Angeles\",\n    year = 2020,\n    geometry = TRUE\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGetting data from the 2016-2020 5-year ACS\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: • You have not set a Census API key. Users without a key are limited to 500\nqueries per day and may experience performance limitations.\nℹ For best results, get a Census API key at\nhttp://api.census.gov/data/key_signup.html and then supply the key to the\n`census_api_key()` function to use it throughout your tidycensus session.\nThis warning is displayed once per session.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nDownloading feature geometry from the Census website.  To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |                                                                      |   1%\n  |                                                                            \n  |=                                                                     |   1%\n  |                                                                            \n  |=                                                                     |   2%\n  |                                                                            \n  |==                                                                    |   2%\n  |                                                                            \n  |==                                                                    |   3%\n  |                                                                            \n  |===                                                                   |   4%\n  |                                                                            \n  |===                                                                   |   5%\n  |                                                                            \n  |====                                                                  |   5%\n  |                                                                            \n  |====                                                                  |   6%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |========                                                              |  11%\n  |                                                                            \n  |=========                                                             |  12%\n  |                                                                            \n  |===========                                                           |  16%\n  |                                                                            \n  |============                                                          |  17%\n  |                                                                            \n  |=============                                                         |  18%\n  |                                                                            \n  |=============                                                         |  19%\n  |                                                                            \n  |==============                                                        |  20%\n  |                                                                            \n  |===============                                                       |  21%\n  |                                                                            \n  |===============                                                       |  22%\n  |                                                                            \n  |=================                                                     |  25%\n  |                                                                            \n  |==================                                                    |  25%\n  |                                                                            \n  |==================                                                    |  26%\n  |                                                                            \n  |====================                                                  |  28%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=========================                                             |  35%\n  |                                                                            \n  |=========================                                             |  36%\n  |                                                                            \n  |==============================                                        |  43%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |===============================                                       |  45%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |==================================                                    |  48%\n  |                                                                            \n  |==================================                                    |  49%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |====================================                                  |  51%\n  |                                                                            \n  |=====================================                                 |  53%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |======================================                                |  55%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |========================================                              |  58%\n  |                                                                            \n  |=========================================                             |  59%\n  |                                                                            \n  |==========================================                            |  60%\n  |                                                                            \n  |===========================================                           |  61%\n  |                                                                            \n  |============================================                          |  63%\n  |                                                                            \n  |=============================================                         |  64%\n  |                                                                            \n  |=============================================                         |  65%\n  |                                                                            \n  |==============================================                        |  65%\n  |                                                                            \n  |==============================================                        |  66%\n  |                                                                            \n  |===============================================                       |  67%\n  |                                                                            \n  |================================================                      |  69%\n  |                                                                            \n  |=================================================                     |  70%\n  |                                                                            \n  |==================================================                    |  72%\n  |                                                                            \n  |===================================================                   |  73%\n  |                                                                            \n  |====================================================                  |  74%\n  |                                                                            \n  |=======================================================               |  79%\n  |                                                                            \n  |========================================================              |  80%\n  |                                                                            \n  |=========================================================             |  81%\n  |                                                                            \n  |==========================================================            |  83%\n  |                                                                            \n  |===========================================================           |  84%\n  |                                                                            \n  |============================================================          |  85%\n  |                                                                            \n  |============================================================          |  86%\n  |                                                                            \n  |===============================================================       |  89%\n  |                                                                            \n  |===============================================================       |  90%\n  |                                                                            \n  |================================================================      |  92%\n  |                                                                            \n  |==================================================================    |  94%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |===================================================================== |  98%\n  |                                                                            \n  |===================================================================== |  99%\n  |                                                                            \n  |======================================================================| 100%\n```\n\n\n:::\n\n```{.r .cell-code}\neconomic_data <- st_transform(economic_data, st_crs(crime_with_neighborhoods))\ncrime_with_income <- st_join(crime_with_neighborhoods, economic_data, join = st_within)\n\n# Summarize crime data by neighborhood, with average income and ensuring valid geometry\ncrime_summary <- crime_with_income %>%\n  group_by(AREA.NAME) %>%\n  summarize(\n    total_crimes = n(),\n    avg_income = mean(estimate, na.rm = TRUE),\n    geometry = st_union(geometry)\n  ) %>%\n  st_as_sf()\n\n# Filter out rows with NA values in avg_income\ncrime_summary <- crime_summary %>% filter(!is.na(avg_income))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Pull median income data for Los Angeles\nincome_data <- get_acs(\n  geography = \"tract\",\n  variables = c(median_income = \"B19013_001\"),\n  state = \"CA\",\n  county = \"Los Angeles\",\n  year = 2020,\n  geometry = TRUE\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGetting data from the 2016-2020 5-year ACS\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nDownloading feature geometry from the Census website.  To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n  |                                                                            \n  |                                                                      |   0%\n  |                                                                            \n  |=======                                                               |  10%\n  |                                                                            \n  |========                                                              |  12%\n  |                                                                            \n  |=============                                                         |  18%\n  |                                                                            \n  |================                                                      |  23%\n  |                                                                            \n  |======================                                                |  31%\n  |                                                                            \n  |======================                                                |  32%\n  |                                                                            \n  |=======================                                               |  33%\n  |                                                                            \n  |=========================                                             |  35%\n  |                                                                            \n  |==========================                                            |  37%\n  |                                                                            \n  |============================                                          |  40%\n  |                                                                            \n  |============================                                          |  41%\n  |                                                                            \n  |==============================                                        |  42%\n  |                                                                            \n  |==============================                                        |  43%\n  |                                                                            \n  |===============================                                       |  44%\n  |                                                                            \n  |================================                                      |  45%\n  |                                                                            \n  |================================                                      |  46%\n  |                                                                            \n  |=================================                                     |  47%\n  |                                                                            \n  |==================================                                    |  48%\n  |                                                                            \n  |===================================                                   |  50%\n  |                                                                            \n  |======================================                                |  54%\n  |                                                                            \n  |=======================================                               |  56%\n  |                                                                            \n  |========================================                              |  57%\n  |                                                                            \n  |=========================================                             |  59%\n  |                                                                            \n  |===========================================                           |  61%\n  |                                                                            \n  |===========================================                           |  62%\n  |                                                                            \n  |==============================================                        |  66%\n  |                                                                            \n  |================================================                      |  68%\n  |                                                                            \n  |==================================================                    |  71%\n  |                                                                            \n  |=====================================================                 |  76%\n  |                                                                            \n  |======================================================                |  77%\n  |                                                                            \n  |==========================================================            |  82%\n  |                                                                            \n  |===========================================================           |  85%\n  |                                                                            \n  |=============================================================         |  87%\n  |                                                                            \n  |==============================================================        |  89%\n  |                                                                            \n  |================================================================      |  91%\n  |                                                                            \n  |=================================================================     |  93%\n  |                                                                            \n  |==================================================================    |  94%\n  |                                                                            \n  |==================================================================    |  95%\n  |                                                                            \n  |===================================================================   |  96%\n  |                                                                            \n  |===================================================================== |  98%\n  |                                                                            \n  |===================================================================== |  99%\n  |                                                                            \n  |======================================================================| 100%\n```\n\n\n:::\n\n```{.r .cell-code}\n# Prepare the data for mapping (ensure CRS consistency)\nincome_data <- st_transform(income_data, crs = st_crs(crime_summary))\n\n# Join income data with crime data (assuming `crime_summary` has neighborhood geometries)\ncrime_income_map <- st_join(crime_summary, income_data, join = st_within)\n\n# Filter out areas with missing income data (if needed)\ncrime_income_map <- crime_income_map %>% filter(!is.na(estimate))\n\n# Ensure geometries are valid and filter out empty or invalid geometries\n# Filter out geometries with coordinates at (0, 0) or zero degrees west (longitude = 0)\ncrime_income_map <- crime_income_map %>%\n  filter(!st_is_empty(geometry)) %>%  # Ensure geometry is not empty\n  filter(!sapply(geometry, function(geom) {\n    coords <- st_coordinates(geom)\n    return(any(coords[,1] == 0 & coords[,2] == 0) || any(coords[,1] == 0) || any(coords[,2] == 0))\n  }))\n\nggplot() +\n  geom_sf(data = income_data, aes(fill = estimate), color = NA) +  # Median income layer\n  geom_sf(data = crime_summary, aes(color = avg_income), size = 2, alpha = 0.7) +  # Crime data layer\n  scale_fill_viridis_c(option = \"magma\", na.value = \"grey50\") +\n  scale_color_viridis_c(option = \"inferno\", na.value = \"grey50\") +\n  labs(\n    title = \"Median Income and Crime Data by Neighborhood in Los Angeles\",\n    fill = \"Median Income\",\n    color = \"Average Income\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 18, hjust = 0.5),\n    legend.title = element_text(size = 14),\n    legend.text = element_text(size = 12),\n    axis.title = element_text(size = 12),\n    axis.text = element_text(size = 10)\n  ) +\n  coord_sf(\n    xlim = c(-119, -117),  # Adjust these values to focus on the Los Angeles area\n    ylim = c(33, 35)       # Adjust these values to focus on the Los Angeles area\n  )\n```\n\n::: {.cell-output-display}\n![](blog-post-5-_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n\n# Input LA Temp CSV and change it to RDS file\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncsvfile <- read.csv(\"latemp.csv\")\nsaveRDS(csvfile, \"latemp.rds\")\n```\n:::\n\n\n## We had combine the temp data and data that we are using by using left join\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlatemp <- readRDS(here(\"latemp.rds\"))\nlatemp <- latemp %>%\n  mutate(DATE = as.Date(DATE)) %>%\n  rename(DATE.OCC = DATE)\nlatemp_unique <- latemp %>%\n  distinct(DATE.OCC, .keep_all = TRUE)\ndata_with_temp <- data %>%\n  left_join(latemp_unique, by = \"DATE.OCC\")\n```\n:::\n\n\n## Find the top 20 temperture that mostly to occur crime\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop_20_temps <- data_with_temp %>%\n  count(TAVG, sort = TRUE) %>%\n  top_n(20, n)\n\ntop_20_temps\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 20 × 2\n    TAVG     n\n   <int> <int>\n 1    60   754\n 2    58   737\n 3    63   660\n 4    67   654\n 5    65   589\n 6    59   584\n 7    62   584\n 8    69   583\n 9    61   564\n10    71   527\n11    66   510\n12    64   498\n13    70   483\n14    72   473\n15    74   461\n16    55   435\n17    57   435\n18    56   431\n19    68   370\n20    73   361\n```\n\n\n:::\n:::\n\n\n\n## ggplot for temp vs crime occurs\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_with_temp, aes(x = TAVG)) +\n  geom_histogram(binwidth = 1, fill = \"blue\", color = \"black\") +\n  labs(title = \"Crime Count by Temperature\",\n       x = \"Average Temperature (TAVG)\",\n       y = \"Crime Count\") +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 29 rows containing non-finite outside the scale range\n(`stat_bin()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](blog-post-5-_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nThe histogram shows that crime counts are higher in the temperature range of approximately 55°F to 75°F. Within this range, the frequency of crimes appears to be fairly consistent, with a peak around 60°F to 70°F. As temperatures exceed 75°F, there is a noticeable decline in crime counts. This suggests that extremely warm days may be associated with lower crime activity. Similarly, at lower temperatures (below 50°F), there are also fewer crime incidents. This could be due to people staying indoors more on colder days, leading to less social interaction and possibly fewer opportunities for crime.",
    "supporting": [
      "blog-post-5-_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}